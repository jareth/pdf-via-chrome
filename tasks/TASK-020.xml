<?xml version="1.0" encoding="UTF-8"?>
<task>
    <task-id>TASK-020</task-id>
    <task-name>Add Unit Tests for Builders</task-name>
    <phase>Phase 3: API Design with Builder Pattern</phase>
    <priority>HIGH</priority>
    <complexity>MODERATE</complexity>

    <dependencies>
        <dependency>TASK-014: Implement PdfOptions.Builder</dependency>
        <dependency>TASK-015: Implement ChromeOptions.Builder</dependency>
        <dependency>TASK-016: Implement PageOptions.Builder</dependency>
        <dependency>TASK-017: Add Validation Logic in Builders</dependency>
    </dependencies>

    <description>
        Create comprehensive unit test suite for all builder classes. Tests should
        cover normal usage, edge cases, validation, and immutability.
    </description>

    <acceptance-criteria>
        <criterion>Test coverage &gt;= 90% for all builder classes</criterion>
        <criterion>Test normal builder usage with all options</criterion>
        <criterion>Test validation error cases</criterion>
        <criterion>Test default values</criterion>
        <criterion>Test immutability of built objects</criterion>
        <criterion>Test builder method chaining</criterion>
        <criterion>Use AssertJ for fluent assertions</criterion>
    </acceptance-criteria>

    <implementation-notes>
        <note>
            Test structure for each builder:
            - testBuildWithAllOptions()
            - testBuildWithDefaults()
            - testValidation_XYZ() for each validation rule
            - testImmutability()
            - testBuilderMethodChaining()
            - testConvenienceMethods() (e.g., a4(), dockerDefaults())
        </note>
        <note>
            Use @ParameterizedTest for testing multiple similar cases
        </note>
        <note>
            Use AssertJ assertions:
            assertThat(options.getScale()).isEqualTo(1.5);
            assertThatThrownBy(() -> builder.scale(3.0).build())
                .isInstanceOf(IllegalArgumentException.class)
                .hasMessageContaining("Scale must be");
        </note>
    </implementation-notes>

    <affected-files>
        <file>headless-chrome-pdf-core/src/test/java/com/github/headlesschromepdf/api/PdfOptionsBuilderTest.java</file>
        <file>headless-chrome-pdf-core/src/test/java/com/github/headlesschromepdf/chrome/ChromeOptionsBuilderTest.java</file>
        <file>headless-chrome-pdf-core/src/test/java/com/github/headlesschromepdf/api/PageOptionsBuilderTest.java</file>
    </affected-files>

    <testing-requirements>
        <requirement>Run tests with 'mvn test'</requirement>
        <requirement>Verify coverage with JaCoCo report</requirement>
        <requirement>All tests pass</requirement>
        <requirement>No flaky tests</requirement>
    </testing-requirements>

    <estimated-effort>6-8 hours</estimated-effort>
</task>
