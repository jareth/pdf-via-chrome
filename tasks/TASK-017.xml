<?xml version="1.0" encoding="UTF-8"?>
<task>
    <task-id>TASK-017</task-id>
    <task-name>Add Validation Logic in Builders</task-name>
    <phase>Phase 3: API Design with Builder Pattern</phase>
    <priority>MEDIUM</priority>
    <complexity>MODERATE</complexity>

    <dependencies>
        <dependency>TASK-014: Implement PdfOptions.Builder</dependency>
        <dependency>TASK-015: Implement ChromeOptions.Builder</dependency>
        <dependency>TASK-016: Implement PageOptions.Builder</dependency>
    </dependencies>

    <description>
        Add comprehensive validation to all builder classes to catch configuration
        errors early with clear error messages. Validation should happen at build()
        time to fail fast.
    </description>

    <acceptance-criteria>
        <criterion>All builders validate parameters in build() method</criterion>
        <criterion>Invalid values throw IllegalArgumentException with clear messages</criterion>
        <criterion>Validation covers ranges, formats, and required fields</criterion>
        <criterion>Unit tests cover all validation scenarios</criterion>
    </acceptance-criteria>

    <implementation-notes>
        <note>
            PdfOptions validation:
            - scale between 0.1 and 2.0
            - margin format: number + valid unit (cm/in/px)
            - pageRanges format validation (regex)
            - paper width/height positive numbers
        </note>
        <note>
            ChromeOptions validation:
            - chromePath exists and is executable
            - remoteDebuggingPort valid range (0-65535)
            - additionalFlags not null
        </note>
        <note>
            PageOptions validation:
            - viewport dimensions positive
            - deviceScaleFactor positive
            - pageLoadTimeout positive duration
        </note>
        <note>
            Use Objects.requireNonNull() for null checks
        </note>
        <note>
            Provide detailed error messages: "Scale must be between 0.1 and 2.0, got: 3.5"
        </note>
    </implementation-notes>

    <affected-files>
        <file>headless-chrome-pdf-core/src/main/java/com/github/headlesschromepdf/api/PdfOptions.java</file>
        <file>headless-chrome-pdf-core/src/main/java/com/github/headlesschromepdf/chrome/ChromeOptions.java</file>
        <file>headless-chrome-pdf-core/src/main/java/com/github/headlesschromepdf/api/PageOptions.java</file>
        <file>headless-chrome-pdf-core/src/test/java/com/github/headlesschromepdf/api/BuilderValidationTest.java</file>
    </affected-files>

    <testing-requirements>
        <requirement>Test each validation rule with invalid input</requirement>
        <requirement>Test error messages are descriptive</requirement>
        <requirement>Test valid inputs pass validation</requirement>
        <requirement>Test null handling where applicable</requirement>
    </testing-requirements>

    <estimated-effort>4-5 hours</estimated-effort>
</task>
