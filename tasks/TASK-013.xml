<?xml version="1.0" encoding="UTF-8"?>
<task>
    <task-id>TASK-013</task-id>
    <task-name>Design and Implement PdfGenerator Fluent API</task-name>
    <phase>Phase 3: API Design with Builder Pattern</phase>
    <priority>HIGH</priority>
    <complexity>COMPLEX</complexity>

    <dependencies>
        <dependency>TASK-008: Implement CdpSession with AutoCloseable</dependency>
        <dependency>TASK-011: Create Exception Hierarchy</dependency>
    </dependencies>

    <description>
        Create the main PdfGenerator fluent API using builder pattern (Design Suggestion #1).
        This is the primary entry point for library users and must implement AutoCloseable
        for resource management. The API should be intuitive, self-documenting, and type-safe.
    </description>

    <acceptance-criteria>
        <criterion>PdfGenerator class implements AutoCloseable</criterion>
        <criterion>Static factory method create() returns builder</criterion>
        <criterion>Fluent API supports method chaining</criterion>
        <criterion>Methods: fromHtml(), fromUrl(), withOptions(), withChrome(), generate()</criterion>
        <criterion>Builder validates configuration before building</criterion>
        <criterion>close() method cleans up Chrome and CDP resources</criterion>
        <criterion>Thread-safe for single generator, multiple PDFs</criterion>
        <criterion>Comprehensive Javadoc with usage examples</criterion>
    </acceptance-criteria>

    <implementation-notes>
        <note>
            API design:
            PdfGenerator generator = PdfGenerator.create()
                .withChromePath("/path/to/chrome")  // optional
                .withTimeout(Duration.ofSeconds(30)) // optional
                .build();

            byte[] pdf = generator.fromHtml("&lt;html&gt;...")
                .withOptions(PdfOptions.builder().landscape(true).build())
                .generate();
        </note>
        <note>
            PdfGenerator.Builder class nested inside PdfGenerator
        </note>
        <note>
            Internally manages ChromeManager and CdpSession
        </note>
        <note>
            close() must close CdpSession and ChromeManager
        </note>
        <note>
            Consider lazy initialization of Chrome (start on first generate())
        </note>
        <note>
            fromHtml() and fromUrl() return intermediate builder for options
        </note>
        <note>
            Validate that either fromHtml() or fromUrl() is called before generate()
        </note>
    </implementation-notes>

    <affected-files>
        <file>headless-chrome-pdf-core/src/main/java/com/github/headlesschromepdf/api/PdfGenerator.java</file>
        <file>headless-chrome-pdf-core/src/test/java/com/github/headlesschromepdf/api/PdfGeneratorTest.java</file>
    </affected-files>

    <testing-requirements>
        <requirement>Unit tests for builder validation</requirement>
        <requirement>Test fluent API method chaining</requirement>
        <requirement>Test AutoCloseable resource cleanup</requirement>
        <requirement>Test error cases (e.g., generate() without fromHtml/fromUrl)</requirement>
        <requirement>Integration test with real PDF generation</requirement>
    </testing-requirements>

    <estimated-effort>10-12 hours</estimated-effort>
</task>
