<?xml version="1.0" encoding="UTF-8"?>
<task>
    <task-id>TASK-035</task-id>
    <task-name>Create Thymeleaf UI (HTML-to-PDF)</task-name>
    <phase>Phase 6: Test Application</phase>
    <priority>MEDIUM</priority>
    <complexity>MODERATE</complexity>

    <dependencies>
        <dependency>TASK-034: Implement REST Endpoints</dependency>
    </dependencies>

    <description>
        Create web UI using Thymeleaf for interactive HTML-to-PDF generation testing.
        Provides form for HTML input with PDF options configuration.
        URL-to-PDF form will be added in Version 2 (Phase 8).
    </description>

    <acceptance-criteria>
        <criterion>Main page accessible at GET /ui or /</criterion>
        <criterion>Form for HTML to PDF conversion with textarea</criterion>
        <criterion>UI elements for common PDF options (landscape, margins, etc.)</criterion>
        <criterion>Download button for generated PDF</criterion>
        <criterion>Error messages displayed for failures</criterion>
        <criterion>Responsive design (works on desktop and mobile)</criterion>
    </acceptance-criteria>
    <note>URL to PDF form moved to Version 2 (Phase 8, TASK-046)</note>

    <implementation-notes>
        <note>
            Create ViewController:
            @GetMapping("/")
            public String index(Model model)
        </note>
        <note>
            Thymeleaf template features:
            - Textarea for HTML input (with syntax highlighting if possible)
            - Checkboxes for boolean options (landscape, printBackground, etc.)
            - Input fields for margins, scale, etc.
            - Generate PDF button that calls REST API via JavaScript
            - Display area for errors and success messages
        </note>
        <note>
            Use Bootstrap or similar CSS framework for styling
        </note>
        <note>
            JavaScript to handle form submission and PDF download
        </note>
        <note>
            Add sample HTML templates in dropdown
        </note>
    </implementation-notes>

    <affected-files>
        <file>pdf-via-chrome-test-app/src/main/java/com/fostermoore/pdfviachrome/testapp/controller/ViewController.java</file>
        <file>pdf-via-chrome-test-app/src/main/resources/templates/index.html</file>
        <file>pdf-via-chrome-test-app/src/main/resources/static/css/style.css</file>
        <file>pdf-via-chrome-test-app/src/main/resources/static/js/app.js</file>
    </affected-files>

    <testing-requirements>
        <requirement>Manual testing in browser</requirement>
        <requirement>Test HTML to PDF conversion via UI</requirement>
        <requirement>Test various PDF options (landscape, margins, scale, etc.)</requirement>
        <requirement>Test sample HTML templates</requirement>
        <requirement>Verify PDF downloads correctly</requirement>
        <requirement>Test error handling and display</requirement>
    </testing-requirements>

    <estimated-effort>6-8 hours</estimated-effort>

    <completion-status>
        <status>COMPLETED</status>
        <completed-date>2025-12-16</completed-date>
        <implementation-summary>
            Successfully implemented Thymeleaf web UI for HTML-to-PDF generation with all acceptance criteria met:

            1. ViewController created with GET mappings for "/" and "/ui"
            2. Comprehensive Thymeleaf template (index.html) with:
               - HTML textarea for content input with character counter
               - Full PDF options controls (paper format, orientation, margins, scale)
               - Boolean options (print background, display header/footer)
               - Advanced options panel (page ranges, CSS page size preference)
               - Header/footer template inputs

            3. Five sample HTML templates in dropdown:
               - Simple document
               - Styled document with CSS
               - Invoice template
               - Report with tables
               - Newsletter design

            4. JavaScript (app.js) implementing:
               - Template selection and loading
               - Form validation
               - API call to POST /api/pdf/from-html
               - PDF download handling
               - Error and success message display
               - Form reset functionality

            5. Custom CSS (style.css) with:
               - Bootstrap 5 integration
               - Responsive design for mobile and desktop
               - Custom styling with gradient theme
               - Smooth animations and transitions

            6. Fixed mapping conflict by moving HealthCheckController to /api/health

            Application successfully tested:
            - UI accessible at http://localhost:8080/ and http://localhost:8080/ui
            - All static resources (CSS, JS) served correctly
            - Responsive design verified
            - Form submits correctly to REST API
        </implementation-summary>

        <files-created>
            <file>pdf-via-chrome-test-app/src/main/java/com/fostermoore/pdfviachrome/testapp/controller/ViewController.java</file>
            <file>pdf-via-chrome-test-app/src/main/resources/templates/index.html</file>
            <file>pdf-via-chrome-test-app/src/main/resources/static/css/style.css</file>
            <file>pdf-via-chrome-test-app/src/main/resources/static/js/app.js</file>
        </files-created>

        <files-modified>
            <file>pdf-via-chrome-test-app/src/main/java/com/fostermoore/pdfviachrome/testapp/controller/HealthCheckController.java</file>
        </files-modified>
    </completion-status>
</task>
