<?xml version="1.0" encoding="UTF-8"?>
<task>
    <task-id>TASK-028</task-id>
    <task-name>Implement CSS Injection Support</task-name>
    <phase>Phase 5: Advanced Features</phase>
    <priority>MEDIUM</priority>
    <complexity>MODERATE</complexity>
    <status>Completed</status>

    <dependencies>
        <dependency>TASK-019: Implement URL-to-PDF Converter</dependency>
    </dependencies>

    <description>
        Add capability to inject custom CSS into pages before PDF generation.
        This allows users to override styles specifically for printing, such as
        hiding navigation, adjusting layouts, or applying print-specific styles.
    </description>

    <acceptance-criteria>
        <criterion>PdfGenerator API supports CSS injection</criterion>
        <criterion>Can inject CSS string</criterion>
        <criterion>Can inject CSS from file</criterion>
        <criterion>CSS applied before PDF generation</criterion>
        <criterion>Works with both HTML and URL sources</criterion>
        <criterion>Integration tests validate CSS is applied</criterion>
    </acceptance-criteria>

    <implementation-notes>
        <note>
            Add method to PdfGenerator builder:
            .withCustomCss(String css)
            .withCustomCssFromFile(Path cssFile)
        </note>
        <note>
            Use CDP CSS.addStyleSheetText() or
            Runtime.evaluate() to inject &lt;style&gt; tag:
            var style = document.createElement('style');
            style.textContent = cssContent;
            document.head.appendChild(style);
        </note>
        <note>
            Inject CSS after page load, before PDF generation
        </note>
        <note>
            Handle CSS syntax errors gracefully
        </note>
    </implementation-notes>

    <affected-files>
        <file>pdf-via-chrome/src/main/java/com/fostermoore/pdfviachrome/api/PdfGenerator.java</file>
        <file>pdf-via-chrome/src/main/java/com/fostermoore/pdfviachrome/converter/HtmlToPdfConverter.java</file>
        <file>pdf-via-chrome/src/main/java/com/fostermoore/pdfviachrome/converter/UrlToPdfConverter.java</file>
        <file>pdf-via-chrome/src/test/java/com/fostermoore/pdfviachrome/CssInjectionTest.java</file>
    </affected-files>

    <testing-requirements>
        <requirement>Unit test CSS injection logic</requirement>
        <requirement>Integration test with custom CSS that hides an element</requirement>
        <requirement>Integration test with CSS from file</requirement>
        <requirement>Verify injected CSS is present in generated PDF</requirement>
    </testing-requirements>

    <estimated-effort>4-5 hours</estimated-effort>

    <completion-status>
        <completion-date>2025-12-31</completion-date>
        <summary>
            CSS injection capability fully implemented in PdfGenerator API. Users can inject custom CSS
            from strings or files to override page styles before PDF generation. Works with both HTML
            and URL sources.
        </summary>
        <deliverables>
            <deliverable>PdfGenerator.withCustomCss(String css) - Inject CSS from string</deliverable>
            <deliverable>PdfGenerator.withCustomCssFromFile(Path cssFile) - Inject CSS from file</deliverable>
            <deliverable>CSS injection uses CDP Runtime.evaluate() to inject style tags</deliverable>
            <deliverable>CSS applied after page load, before PDF generation</deliverable>
            <deliverable>CssInjectionTest.java - Comprehensive unit tests for CSS injection</deliverable>
            <deliverable>Integration tests in AdvancedFeaturesIT.java</deliverable>
            <deliverable>Usage examples in README.md and CLAUDE.md</deliverable>
        </deliverables>
    </completion-status>
</task>
