<?xml version="1.0" encoding="UTF-8"?>
<task>
    <task-id>TASK-023</task-id>
    <task-name>Implement NetworkIdleWait Strategy</task-name>
    <phase>Phase 8: Version 2: URL-to-PDF Features</phase>
    <priority>HIGH</priority>
    <complexity>COMPLEX</complexity>

    <dependencies>
        <dependency>TASK-022: Design WaitStrategy Interface</dependency>
        <dependency>TASK-019: Implement URL-to-PDF Converter</dependency>
    </dependencies>

    <description>
        Implement NetworkIdleWait strategy that waits until network activity stops
        for a specified duration. This is useful for pages with AJAX requests and
        dynamic content loading.
    </description>

    <acceptance-criteria>
        <criterion>NetworkIdleWait class implements WaitStrategy</criterion>
        <criterion>Monitors network activity using CDP Network domain</criterion>
        <criterion>Waits for specified quiet period (default 500ms)</criterion>
        <criterion>Configurable number of max inflight requests (default 0)</criterion>
        <criterion>Respects overall timeout</criterion>
        <criterion>Unit and integration tests</criterion>
    </acceptance-criteria>

    <implementation-notes>
        <note>
            Use CDP Network domain events:
            - Network.enable(): Start monitoring
            - Network.requestWillBeSent: Request started
            - Network.responseReceived: Response received
            - Network.loadingFinished: Request completed
            - Network.loadingFailed: Request failed
        </note>
        <note>
            Track inflight request count
        </note>
        <note>
            When count &lt;= maxInflightRequests for quietPeriod duration, consider idle
        </note>
        <note>
            Use CompletableFuture or CountDownLatch for async waiting
        </note>
        <note>
            Default: 500ms quiet period, 0 max inflight requests
        </note>
    </implementation-notes>

    <affected-files>
        <file>headless-chrome-pdf-core/src/main/java/com/github/headlesschromepdf/wait/NetworkIdleWait.java</file>
        <file>headless-chrome-pdf-core/src/test/java/com/github/headlesschromepdf/wait/NetworkIdleWaitTest.java</file>
    </affected-files>

    <testing-requirements>
        <requirement>Unit test with mocked Network domain</requirement>
        <requirement>Integration test with page that has delayed AJAX</requirement>
        <requirement>Test timeout handling</requirement>
        <requirement>Test with various quiet period durations</requirement>
    </testing-requirements>

    <estimated-effort>8-10 hours</estimated-effort>
</task>
