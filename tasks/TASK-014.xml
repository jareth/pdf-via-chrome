<?xml version="1.0" encoding="UTF-8"?>
<task>
    <task-id>TASK-014</task-id>
    <task-name>Implement PdfOptions.Builder</task-name>
    <phase>Phase 3: API Design with Builder Pattern</phase>
    <priority>HIGH</priority>
    <complexity>MODERATE</complexity>
    <status>Completed</status>

    <dependencies>
        <dependency>TASK-013: Design and Implement PdfGenerator Fluent API</dependency>
    </dependencies>

    <description>
        Implement PdfOptions class with builder pattern for configuring PDF generation
        parameters. This maps to Chrome DevTools Protocol Page.printToPDF parameters
        and provides a type-safe, fluent API.
    </description>

    <acceptance-criteria>
        <criterion>PdfOptions class with all CDP printToPDF parameters</criterion>
        <criterion>PdfOptions.Builder with fluent API</criterion>
        <criterion>Builder validates parameter ranges and formats</criterion>
        <criterion>Default values match CDP defaults</criterion>
        <criterion>Immutable PdfOptions instance returned by build()</criterion>
        <criterion>Supports common paper sizes (A4, Letter, Legal)</criterion>
        <criterion>Margin units: cm, in, px</criterion>
    </acceptance-criteria>

    <implementation-notes>
        <note>
            PDF options to support:
            - landscape: boolean (default false)
            - displayHeaderFooter: boolean (default false)
            - printBackground: boolean (default false)
            - scale: double (0.1-2.0, default 1.0)
            - paperWidth: double (inches)
            - paperHeight: double (inches)
            - marginTop, marginBottom, marginLeft, marginRight: String with unit
            - pageRanges: String (e.g., "1-5, 8, 11-13")
            - headerTemplate: String (HTML)
            - footerTemplate: String (HTML)
            - preferCSSPageSize: boolean (default false)
        </note>
        <note>
            Add convenience methods for paper sizes:
            - a4(): Sets paperWidth=8.27in, paperHeight=11.69in
            - letter(): Sets paperWidth=8.5in, paperHeight=11in
            - legal(): Sets paperWidth=8.5in, paperHeight=14in
        </note>
        <note>
            Validate scale is between 0.1 and 2.0
        </note>
        <note>
            Parse margin strings to validate format (number + unit)
        </note>
        <note>
            PdfOptions should be immutable (final fields, no setters)
        </note>
    </implementation-notes>

    <affected-files>
        <file>pdf-via-chrome/src/main/java/com/fostermoore/pdfviachrome/api/PdfOptions.java</file>
        <file>pdf-via-chrome/src/test/java/com/fostermoore/pdfviachrome/api/PdfOptionsTest.java</file>
    </affected-files>

    <testing-requirements>
        <requirement>Test builder with all options</requirement>
        <requirement>Test validation (e.g., scale out of range throws exception)</requirement>
        <requirement>Test paper size convenience methods</requirement>
        <requirement>Test margin parsing and validation</requirement>
        <requirement>Test default values</requirement>
        <requirement>Test immutability</requirement>
    </testing-requirements>

    <estimated-effort>6-8 hours</estimated-effort>
</task>
