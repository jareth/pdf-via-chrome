<?xml version="1.0" encoding="UTF-8"?>
<task>
    <task-id>TASK-043</task-id>
    <task-name>Create URL-to-PDF Integration Tests</task-name>
    <phase>Phase 8: Version 2 - URL-to-PDF Features and Advanced Web Capabilities</phase>
    <priority>HIGH</priority>
    <complexity>COMPLEX</complexity>
    <status>Completed</status>

    <dependencies>
        <dependency>TASK-019: Create URL-to-PDF Converter</dependency>
        <dependency>TASK-021: Create Integration Tests with Testcontainers (HTML-to-PDF)</dependency>
    </dependencies>

    <description>
        Create comprehensive integration test suite for URL-to-PDF conversion functionality.
        These tests validate end-to-end URL-to-PDF generation with real Chrome instances,
        including navigation, page loading, timeout handling, error scenarios, and various
        URL formats. This task was split from TASK-021 to separate URL-specific tests from
        HTML-to-PDF tests, supporting the phased approach where URL-to-PDF is Version 2.
    </description>

    <acceptance-criteria>
        <criterion>Integration tests for UrlToPdfConverter class</criterion>
        <criterion>Tests use actual Chrome instances (not Testcontainers to avoid internet access issues)</criterion>
        <criterion>Tests are disabled by default and enabled via environment variable</criterion>
        <criterion>Tests validate URL navigation and PDF generation</criterion>
        <criterion>Tests cover various URL formats (HTTP, HTTPS, query parameters, fragments)</criterion>
        <criterion>Tests validate custom PDF options with URLs</criterion>
        <criterion>Tests validate header and footer functionality with URLs</criterion>
        <criterion>Tests validate error handling (invalid domains, timeouts, disconnected sessions)</criterion>
        <criterion>Tests validate edge cases (404 pages, multiple conversions)</criterion>
        <criterion>Generated PDFs are validated (PDF signature, non-empty content)</criterion>
        <criterion>Tests run with 'mvn verify' when enabled</criterion>
    </acceptance-criteria>

    <implementation-notes>
        <note>
            Use @EnabledIfEnvironmentVariable annotation to disable tests by default
            Tests require: CHROME_INTEGRATION_TESTS=true
            Run with: mvn verify -DCHROME_INTEGRATION_TESTS=true
        </note>
        <note>
            Unlike HTML-to-PDF tests, URL tests use actual Chrome on the system
            This is because URLs require internet access, which is problematic in containers
        </note>
        <note>
            Test scenarios implemented:
            - Simple URL to PDF conversion (example.com)
            - URL with custom PDF options (landscape, A4, margins, scale, background)
            - Multiple URL conversions in same session
            - URL with header and footer templates
            - Convenience method with default options
            - Error handling: disconnected session
            - Error handling: short timeout (1ms)
            - Error handling: invalid domain (DNS failure)
            - Edge case: 404 page (should succeed with error page PDF)
            - HTTP URLs (not just HTTPS)
            - URLs with query parameters
            - URLs with fragments
            - Print background option
        </note>
        <note>
            Validation approach:
            - Check PDF magic number (%PDF-)
            - Verify non-empty content
            - Verify minimum size (>100 bytes)
            - Verify exceptions for error scenarios
        </note>
        <note>
            Tests class name: UrlToPdfConverterIT.java (for failsafe plugin)
        </note>
    </implementation-notes>

    <affected-files>
        <file>pdf-via-chrome/src/test/java/com/fostermoore/pdfviachrome/converter/UrlToPdfConverterIT.java</file>
    </affected-files>

    <testing-requirements>
        <requirement>Tests run with 'mvn verify -DCHROME_INTEGRATION_TESTS=true'</requirement>
        <requirement>Tests are disabled by default (require explicit environment variable)</requirement>
        <requirement>Tests require Chrome installed on system</requirement>
        <requirement>Tests require internet connectivity</requirement>
        <requirement>All 13 integration tests pass</requirement>
        <requirement>Generated PDFs are valid</requirement>
        <requirement>Error scenarios throw appropriate exceptions</requirement>
        <requirement>Tests clean up Chrome processes after execution</requirement>
    </testing-requirements>

    <test-coverage>
        <test>testConvertSimpleUrlToPdf - Basic URL to PDF conversion</test>
        <test>testConvertUrlWithCustomPdfOptions - Custom options (landscape, A4, margins, scale, background)</test>
        <test>testConvertMultipleUrls - Multiple conversions in same session</test>
        <test>testConvertUrlWithHeaderAndFooter - Header and footer templates</test>
        <test>testConvertWithDefaultMethod - Convenience method with defaults</test>
        <test>testConvertWithDisconnectedSession - Error handling for disconnected session</test>
        <test>testConvertWithShortTimeout - Timeout exception handling</test>
        <test>testConvertInvalidDomain - DNS resolution failure</test>
        <test>testConvert404Page - 404 pages should generate PDF of error page</test>
        <test>testConvertHttpUrl - HTTP (not HTTPS) URLs</test>
        <test>testConvertUrlWithQueryParameters - URLs with query strings</test>
        <test>testConvertUrlWithFragment - URLs with fragments</test>
        <test>testConvertWithPrintBackground - Print background option</test>
    </test-coverage>

    <estimated-effort>6-8 hours</estimated-effort>
    <actual-effort>Completed as part of TASK-019 implementation</actual-effort>
    <completion-date>2025-12-29</completion-date>
</task>
